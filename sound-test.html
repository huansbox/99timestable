<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>音效測試 - 九九乘法表</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .title {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .global-controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-weight: bold;
            color: #333;
            min-width: 80px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            border: none;
        }

        .value-display {
            font-weight: bold;
            color: #4f46e5;
            min-width: 50px;
            text-align: center;
        }

        .sound-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .sound-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .sound-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .sound-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .sound-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .sound-params {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #555;
        }

        .play-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .play-button:hover {
            background: linear-gradient(135deg, #3730a3, #5b21b6);
            transform: translateY(-2px);
        }

        .play-button:active {
            transform: translateY(0);
        }

        .play-button.playing {
            background: linear-gradient(135deg, #10b981, #059669);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .copy-button {
            width: 100%;
            padding: 10px;
            border: 2px solid #4f46e5;
            border-radius: 8px;
            background: white;
            color: #4f46e5;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            background: #4f46e5;
            color: white;
        }

        .category-title {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 40px 0 20px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .note {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            color: white;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .sound-grid {
                grid-template-columns: 1fr;
            }

            .title {
                font-size: 1.5rem;
            }

            .control-group {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .control-label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">🎵 音效測試中心</h1>
            <p class="subtitle">九九乘法表練習音效選擇</p>
        </div>

        <div class="global-controls">
            <div class="control-group">
                <label class="control-label">音量：</label>
                <input type="range" id="volume-slider" class="slider" min="0.1" max="0.5" value="0.3" step="0.05">
                <span id="volume-value" class="value-display">0.3</span>
            </div>
            <div class="control-group">
                <label class="control-label">速度：</label>
                <input type="range" id="speed-slider" class="slider" min="0.5" max="2" value="1" step="0.1">
                <span id="speed-value" class="value-display">1.0x</span>
            </div>
        </div>

        <h2 class="category-title">🏆 答對音效選項</h2>
        <div class="sound-grid" id="correct-sounds">
            <!-- 答對音效卡片將在這裡動態生成 -->
        </div>

        <h2 class="category-title">❌ 答錯音效選項</h2>
        <div class="sound-grid" id="incorrect-sounds">
            <!-- 答錯音效卡片將在這裡動態生成 -->
        </div>

        <div class="note">
            <h3>📝 使用說明</h3>
            <p>• 調整音量和速度來測試不同效果</p>
            <p>• 點擊「播放音效」試聽</p>
            <p>• 點擊「複製程式碼」可以獲得該音效的實作程式碼</p>
            <p>• 建議選擇音量適中（0.2-0.3）的音效，避免嚇到小朋友</p>
        </div>
    </div>

    <script>
        // 全域音效控制
        let globalVolume = 0.3;
        let globalSpeed = 1.0;

        // 音效定義
        const correctSounds = [
            {
                name: "經典勝利號角",
                description: "「等能等登登」的經典喇叭音效，使用 C-E-G-C 和弦進行，適合重要成就",
                params: "4個音符 | Square波形 | 0.8秒",
                generate: function(audioContext, volume, speed) {
                    const notes = [
                        {freq: 261.63, start: 0, duration: 0.2 / speed},      // C4 - 等
                        {freq: 329.63, start: 0.2 / speed, duration: 0.2 / speed}, // E4 - 能
                        {freq: 392.00, start: 0.4 / speed, duration: 0.2 / speed}, // G4 - 等
                        {freq: 523.25, start: 0.6 / speed, duration: 0.3 / speed}  // C5 - 登登～
                    ];

                    notes.forEach(note => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.type = 'square';
                        oscillator.frequency.value = note.freq;

                        gainNode.gain.setValueAtTime(0, audioContext.currentTime + note.start);
                        gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + note.start + 0.02 / speed);
                        gainNode.gain.exponentialRampToValueAtTime(volume * 0.7, audioContext.currentTime + note.start + note.duration * 0.7);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + note.start + note.duration);

                        oscillator.start(audioContext.currentTime + note.start);
                        oscillator.stop(audioContext.currentTime + note.start + note.duration);
                    });
                }
            },
            {
                name: "遊戲過關音效",
                description: "快速上升的音階，明亮歡快，類似 Mario 過關音效",
                params: "6個音符 | Sine波形 | 0.6秒",
                generate: function(audioContext, volume, speed) {
                    const notes = [261.63, 329.63, 392.00, 523.25, 659.25, 783.99]; // C-E-G-C-E-G

                    notes.forEach((freq, i) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.type = 'sine';
                        oscillator.frequency.value = freq;

                        const startTime = audioContext.currentTime + (i * 0.1 / speed);
                        const duration = 0.15 / speed;

                        gainNode.gain.setValueAtTime(0, startTime);
                        gainNode.gain.linearRampToValueAtTime(volume, startTime + 0.01 / speed);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);

                        oscillator.start(startTime);
                        oscillator.stop(startTime + duration);
                    });
                }
            },
            {
                name: "簡短成功音",
                description: "兩個音符的簡單組合，清脆的鈴聲效果，不會過於突兀",
                params: "2個音符 | Triangle波形 | 0.4秒",
                generate: function(audioContext, volume, speed) {
                    const notes = [523.25, 783.99]; // C5, G5

                    notes.forEach((freq, i) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.type = 'triangle';
                        oscillator.frequency.value = freq;

                        const startTime = audioContext.currentTime + (i * 0.15 / speed);
                        const duration = 0.2 / speed;

                        gainNode.gain.setValueAtTime(0, startTime);
                        gainNode.gain.linearRampToValueAtTime(volume, startTime + 0.02 / speed);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);

                        oscillator.start(startTime);
                        oscillator.stop(startTime + duration);
                    });
                }
            },
            {
                name: "豐富號角音",
                description: "混合多個振盪器模擬真實喇叭，有豐富的泛音和包絡控制",
                params: "混合音色 | ADSR包絡 | 0.8秒",
                generate: function(audioContext, volume, speed) {
                    const notes = [261.63, 329.63, 392.00, 523.25];

                    notes.forEach((freq, i) => {
                        // 基頻
                        const osc1 = audioContext.createOscillator();
                        const gain1 = audioContext.createGain();
                        osc1.type = 'sawtooth';
                        osc1.frequency.value = freq;

                        // 二次諧波
                        const osc2 = audioContext.createOscillator();
                        const gain2 = audioContext.createGain();
                        osc2.type = 'square';
                        osc2.frequency.value = freq * 2;

                        // 混合
                        const mixer = audioContext.createGain();

                        osc1.connect(gain1);
                        osc2.connect(gain2);
                        gain1.connect(mixer);
                        gain2.connect(mixer);
                        mixer.connect(audioContext.destination);

                        gain1.gain.value = volume * 0.7;
                        gain2.gain.value = volume * 0.3;

                        const startTime = audioContext.currentTime + (i * 0.2 / speed);
                        const duration = 0.25 / speed;

                        mixer.gain.setValueAtTime(0, startTime);
                        mixer.gain.linearRampToValueAtTime(1, startTime + 0.02 / speed);
                        mixer.gain.linearRampToValueAtTime(0.7, startTime + 0.05 / speed);
                        mixer.gain.setValueAtTime(0.7, startTime + duration - 0.05 / speed);
                        mixer.gain.exponentialRampToValueAtTime(0.01, startTime + duration);

                        osc1.start(startTime);
                        osc2.start(startTime);
                        osc1.stop(startTime + duration);
                        osc2.stop(startTime + duration);
                    });
                }
            }
        ];

        const incorrectSounds = [
            {
                name: "溫和下降音",
                description: "柔和的下降音調，不會讓小朋友感到挫折",
                params: "下降頻率 | Sine波形 | 0.3秒",
                generate: function(audioContext, volume, speed) {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.type = 'sine';
                    const duration = 0.3 / speed;

                    oscillator.frequency.setValueAtTime(350, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + duration);

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.02 / speed);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }
            },
            {
                name: "低沉蜂鳴聲",
                description: "溫和的低頻蜂鳴，提示但不刺耳",
                params: "低頻 | Square波形 | 0.4秒",
                generate: function(audioContext, volume, speed) {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.type = 'square';
                    oscillator.frequency.value = 150;

                    const duration = 0.4 / speed;

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05 / speed);
                    gainNode.gain.setValueAtTime(volume, audioContext.currentTime + duration - 0.1 / speed);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }
            },
            {
                name: "泡泡破裂聲",
                description: "輕柔的泡泡破裂音效，有趣而不令人沮喪",
                params: "白噪音 | 濾波器 | 0.2秒",
                generate: function(audioContext, volume, speed) {
                    // 創建白噪音
                    const bufferSize = audioContext.sampleRate * 0.2 / speed;
                    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                    const data = buffer.getChannelData(0);

                    for (let i = 0; i < bufferSize; i++) {
                        data[i] = (Math.random() * 2 - 1) * 0.3;
                    }

                    const source = audioContext.createBufferSource();
                    const filter = audioContext.createBiquadFilter();
                    const gainNode = audioContext.createGain();

                    source.buffer = buffer;
                    filter.type = 'highpass';
                    filter.frequency.value = 2000;

                    source.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    const duration = 0.2 / speed;

                    gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                    source.start(audioContext.currentTime);
                    source.stop(audioContext.currentTime + duration);
                }
            }
        ];

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            setupControls();
            renderSoundCards();
        });

        function setupControls() {
            const volumeSlider = document.getElementById('volume-slider');
            const speedSlider = document.getElementById('speed-slider');
            const volumeValue = document.getElementById('volume-value');
            const speedValue = document.getElementById('speed-value');

            volumeSlider.addEventListener('input', function() {
                globalVolume = parseFloat(this.value);
                volumeValue.textContent = globalVolume.toFixed(1);
            });

            speedSlider.addEventListener('input', function() {
                globalSpeed = parseFloat(this.value);
                speedValue.textContent = globalSpeed.toFixed(1) + 'x';
            });
        }

        function renderSoundCards() {
            renderSounds(correctSounds, 'correct-sounds');
            renderSounds(incorrectSounds, 'incorrect-sounds');
        }

        function renderSounds(sounds, containerId) {
            const container = document.getElementById(containerId);

            sounds.forEach((sound, index) => {
                const card = document.createElement('div');
                card.className = 'sound-card';
                card.innerHTML = `
                    <h3 class="sound-title">${sound.name}</h3>
                    <p class="sound-description">${sound.description}</p>
                    <div class="sound-params">${sound.params}</div>
                    <button class="play-button" onclick="playSound(${containerId === 'correct-sounds' ? 'correctSounds' : 'incorrectSounds'}, ${index}, this)">
                        🔊 播放音效
                    </button>
                    <button class="copy-button" onclick="copyCode(${containerId === 'correct-sounds' ? 'correctSounds' : 'incorrectSounds'}, ${index})">
                        📋 複製程式碼
                    </button>
                `;
                container.appendChild(card);
            });
        }

        function playSound(soundArray, index, button) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // UI 效果
            button.classList.add('playing');
            button.textContent = '🔊 播放中...';

            // 播放音效
            soundArray[index].generate(audioContext, globalVolume, globalSpeed);

            // 恢復按鈕狀態
            setTimeout(() => {
                button.classList.remove('playing');
                button.textContent = '🔊 播放音效';
            }, 1000 / globalSpeed);
        }

        function copyCode(soundArray, index) {
            const sound = soundArray[index];
            const code = `// ${sound.name}
function play${sound.name.replace(/\s+/g, '')}() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    ${sound.generate.toString().split('\n').slice(1, -1).join('\n    ')}
}

// 使用方式：
// play${sound.name.replace(/\s+/g, '')}();`;

            navigator.clipboard.writeText(code).then(() => {
                alert('程式碼已複製到剪貼簿！');
            }).catch(() => {
                console.log('程式碼複製失敗，請手動複製：\n\n' + code);
            });
        }
    </script>
</body>
</html>