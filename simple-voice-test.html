<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>簡單語音測試</title>
    <style>
        body { font-family: Arial; text-align: center; padding: 50px; }
        button { padding: 20px; font-size: 20px; margin: 10px; }
        #result { margin: 20px; font-size: 18px; }
        .listening { background: red; color: white; }
    </style>
</head>
<body>
    <h1>簡單語音測試</h1>
    <p>3 × 4 = ?</p>

    <button id="startBtn">🎤 開始錄音</button>
    <button id="stopBtn" disabled>⏹️ 停止錄音</button>

    <div id="result">等待測試...</div>

    <script>
        let recognition = null;
        let isListening = false;

        // 檢查支援
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'zh-TW';
            recognition.continuous = false;
            recognition.interimResults = true;

            recognition.onstart = () => {
                console.log('開始錄音');
                isListening = true;
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('startBtn').className = 'listening';
                document.getElementById('result').textContent = '正在聆聽...';
            };

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = 0; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                document.getElementById('result').textContent = '聽到：' + transcript;
            };

            recognition.onend = () => {
                console.log('結束錄音');
                isListening = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('startBtn').className = '';
            };

            recognition.onerror = (event) => {
                document.getElementById('result').textContent = '錯誤：' + event.error;
                console.error('語音識別錯誤:', event);
            };

        } else {
            document.getElementById('result').textContent = '瀏覽器不支援語音識別';
        }

        document.getElementById('startBtn').onclick = () => {
            if (recognition && !isListening) {
                try {
                    recognition.start();
                } catch (e) {
                    document.getElementById('result').textContent = '啟動失敗：' + e.message;
                }
            }
        };

        document.getElementById('stopBtn').onclick = () => {
            if (recognition && isListening) {
                recognition.stop();
            }
        };
    </script>
</body>
</html>